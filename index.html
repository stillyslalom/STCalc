<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<html><head>
<title>Shock Tube Calculator</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;600;700&display=swap" rel="stylesheet">
<link href="WiSTL%20Gas%20Dynamics%20Calculator_files/web.css" rel="stylesheet" type="text/css">
<!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> -->
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<style type="text/css">
body {
    font-family: 'Source Sans Pro', Arial, sans-serif;
    margin: 20px;
    background-color: #f5f5f5;
}
.container {
    max-width: 1200px;
    margin: 0 auto;
    background-color: white;
    padding: 30px;
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}
h1 {
    color: #333;
    border-bottom: 2px solid #990000;
    padding-bottom: 10px;
}
h2 {
    color: #333;
    margin-top: 20px;
    margin-bottom: 15px;
}
h3 {
    color: #333;
    margin-top: 15px;
    margin-bottom: 10px;
    clear: both;
}
table {
    margin-top: 10px;
}
/* Modal styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.6);
}
.modal-content {
    background-color: #fefefe;
    margin: 3% auto;
    padding: 30px;
    border: 1px solid #888;
    width: 90%;
    max-width: 800px;
    max-height: 85vh;
    overflow-y: auto;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid #990000;
}
.modal-header h2 {
    margin: 0;
    color: #990000;
}
.close {
    color: #aaa;
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
    line-height: 1;
    transition: color 0.3s;
}
.close:hover,
.close:focus {
    color: #000;
}
.equation-section {
    margin-bottom: 25px;
}
.equation-section h3 {
    color: #990000;
    margin-top: 20px;
    margin-bottom: 10px;
}
.equation-note {
    font-style: italic;
    color: #666;
    margin-top: 20px;
    padding: 10px;
    background-color: #f5f5f5;
    border-left: 3px solid #990000;
}
</style>
</head>
<body>

<div class="container">

<script language="JavaScript1.2">



function calcShock() {

        var p1,p2,p5,p2p1,p5p2;  //pressure and ratio

        var t1,t2,t5,t2t1,t5t2;  //temperature and ratio

        var d1,d2,d5,d2d1,d5d2;  //density and ratio

        var a1,a2,a5;            //speed of sound

        var m,g,gp,gm,mw,ru,r;

        var u2,w;

        var mr,wr;

        var g4,mw4,a4,p4p1,p4,r4,t4,areafactor;

        var d4,p4p1exp,p4p1arg;

        m  = parseFloat(document.Shock.mach.value);

        p1 = parseFloat(document.Shock.pinit.value);

        t1 = parseFloat(document.Shock.tinit.value);

        areafactor = parseFloat(document.Shock.areafact.value);

        //decide driven gas;

        if (document.Shock.drivengas.value == "custom"){
            // Calculate properties for custom mixture
            var drivenProps = calculateMixtureProperties('driven');
            if (drivenProps === null) {
                return; // Error already shown in calculateMixtureProperties
            }
            g = drivenProps.gamma;
            mw = drivenProps.mw;
        }
        else if (document.Shock.drivengas.value == "1"){

              g=parseFloat(1.4020);

              mw=parseFloat(28.9660);

            }

        else if (document.Shock.drivengas.value == "2"){

             g=parseFloat(1.6700);

            mw=parseFloat(39.948000);

            }

        else if (document.Shock.drivengas.value == "3"){

             g=parseFloat(1.29700);

            mw=parseFloat(44.01000);

            }

        else if (document.Shock.drivengas.value == "4"){

             g=parseFloat(1.66700);

            mw=parseFloat(4.002602000);

            }

        else if (document.Shock.drivengas.value == "5"){

             g=parseFloat(1.66700);

            mw=parseFloat(20.179700);

            }

        else if (document.Shock.drivengas.value == "6"){

             g=parseFloat(1.40100);

            mw=parseFloat(28.0134000);

            }

        else if (document.Shock.drivengas.value == "7"){

             g=parseFloat(1.66700);

            mw=parseFloat(131.29000);

            }

        else if (document.Shock.drivengas.value == "8"){

             g=parseFloat(1.09200);

            mw=parseFloat(146.06000);

            }

		else if (document.Shock.drivengas.value == "9"){

             g=parseFloat(1.668);

            mw=parseFloat(21.98);

            }

        else if (document.Shock.drivengas.value == "10"){

             g=parseFloat(1.14000);

            mw=parseFloat(58.08000);

            }

        // decide driver gas

        if (document.Shock.drivergas.value == "custom"){
            // Calculate properties for custom mixture
            var driverProps = calculateMixtureProperties('driver');
            if (driverProps === null) {
                return; // Error already shown in calculateMixtureProperties
            }
            g4 = driverProps.gamma;
            mw4 = driverProps.mw;
        }
        else if (document.Shock.drivergas.value == "1"){

              g4=parseFloat(1.4020);

              mw4=parseFloat(28.9660);

            }

        else if (document.Shock.drivergas.value == "2"){

             g4=parseFloat(1.6700);

            mw4=parseFloat(39.948000);

            }

        else if (document.Shock.drivergas.value == "3"){

             g4=parseFloat(1.29700);

            mw4=parseFloat(44.01000);

            }

        else if (document.Shock.drivergas.value == "4"){

             g4=parseFloat(1.66700);

            mw4=parseFloat(4.002602000);

            }

        else if (document.Shock.drivergas.value == "5"){

             g4=parseFloat(1.66700);

            mw4=parseFloat(20.179700);

            }

        else if (document.Shock.drivergas.value == "6"){

             g4=parseFloat(1.40100);

            mw4=parseFloat(28.0134000);

            }

        else if (document.Shock.drivergas.value == "7"){

             g4=parseFloat(1.66700);

            mw4=parseFloat(131.29000);

            }

        else if (document.Shock.drivergas.value == "8"){

             g4=parseFloat(1.09200);

            mw4=parseFloat(146.06000);

            }

        else if (document.Shock.drivergas.value == "10"){

             g4=parseFloat(1.14000);

            mw4=parseFloat(58.08000);

            }

      	t4 = parseFloat(document.Shock.tid.value);

	//document.write("t4 " + t4 + "  ");    

        gp = g + 1.00;

        gm = g - 1.00;

      	//document.write("gm " + gm + "  ");

        //document.write("g " + g + "  ");

        //document.write("mw " + mw + "  ");

        ru=parseFloat(8314.510);

        //document.write("ru " + ru + "  ");

        r=ru/mw;

        //document.write("r " + r + "  ");

        a1=Math.sqrt(g*r*t1);

        w=a1*m;

        d1=p1/r/t1;

        //document.write("p2 " + t1 + "  ");

        //document.write("gp " + gp + "  ");

        //document.write("gm " + gm + "  ");

        //ees p2p1=1+((2*gamma_1)/gp_1)*(M_init^2-1);

        //

        //  State 2 properties

        //

        p2p1=1+2*g/gp*(Math.pow(m,2)-1);

        p2=p2p1*p1;

        t2t1=p2p1*((gp/gm+p2p1)/(1+gp/gm*p2p1));

        t2=t2t1*t1;

        a2=Math.sqrt(g*r*t2);

        //ees rho2rho1=(1+gp_1/gm_1*p2p1)/(gp_1/gm_1+p2p1)

	d2d1=(1+(gp/gm)*p2p1)/(gp/gm+p2p1);

	d2=d2d1*d1;

	//ees u_2=c_1/gamma_1*(p2p1-1)*((2*gamma_1/gp_1)/(p2p1+gm_1/gp_1))^0.5

	u2=a1/g*(p2p1-1)*(Math.sqrt((2*g/gp)/(p2p1+gm/gp)));

        //

        //  State 4 properties

        //

	//document.write("gm " + gm + "  ");

        r4=ru/mw4;

        a4=Math.sqrt(g4*r4*t4);

        //ees p4p1=p2p1*(1-((gamma_4-1)*(a_1/a_4)*(p2p1-1))/sqrt(2*gamma_1*(2*gamma_1+;

	//         (gamma_1+1)*(p2p1-1))))^(-2*gamma_4/(gamma_4-1)) ;

        p4p1exp=(-2*g4/(g4-1));

        p4p1arg=(1-((g4-1)*(a1/a4)*(p2p1-1))/Math.sqrt(2*g*(2*g+gp*(p2p1-1))));

	p4p1=p2p1*Math.pow(p4p1arg,p4p1exp);

	p4=p4p1*p1;

	d4=p4/r4/t4;

        //document.write("t4 " + t4 + "  ");

        //document.write("a4 " + a4 + "  ");

        //

        //  State 5 properties

        //

        p5p2=((3*g-1)*p2p1-gm)/(gm*p2p1+gp);

        p5=p5p2*p2;

        t5t2=p5p2*((gp/gm+p5p2)/(1+gp/gm*p5p2));

        t5=t5t2*t2;

        d5d2=(1+(gp/gm)*p5p2)/(gp/gm+p5p2);

	d5=d5d2*d2;

        a5=Math.sqrt(g*r*t5);

        wr=(d2*u2)/(d5-d2);

        mr=(wr+u2)/a2;

        document.Shock.pdriv.value = p1/1e6;

        document.Shock.tdriv.value = t1;

        document.Shock.ddriv.value = d1;

        document.Shock.adriv.value = a1;

        document.Shock.pshocked.value = p2/1e6;

        document.Shock.tshocked.value = t2;

        document.Shock.dshocked.value = d2;

        document.Shock.ashocked.value = a2;

        document.Shock.ushocked.value = u2;

        document.Shock.pfour.value = p4/1e6;

        document.Shock.pfourpsig.value = (((p4-101325.0)/101325.0)*14.696)/areafactor;

        document.Shock.tfour.value = t4;

        document.Shock.dfour.value = d4;

        document.Shock.afour.value = a4;

        document.Shock.preflect.value = p5/1e6;

        document.Shock.treflect.value = t5;

        document.Shock.dreflect.value = d5;

        document.Shock.areflect.value = a5;

        document.Shock.wreflect.value = wr;

        document.Shock.mreflect.value = mr;

        document.Shock.wshocked.value = w;

        document.Shock.outmw.value = mw;

        document.Shock.outgamma.value = g;

        // Save calculator state to localStorage
        saveCalculatorState();

}



function calcTime() {

        var xwave,xtrig,twave,wactual,mactual,xint;

        var tdelayshock,tdelaymembrane,u2;

        xwave = parseFloat(document.Timing.xwave.value);

        twave = parseFloat(document.Timing.twave.value)/1000.00;

        u2 = parseFloat(document.Shock.ushocked.value);

        wactual=xwave/twave;

        mactual=wactual/parseFloat(document.Shock.adriv.value);

        xtrig = parseFloat(document.Timing.xtrig.value);

        xint = parseFloat(document.Timing.xint.value);

        tdelayshock=xtrig/wactual*1000;

        tdelaymembrane=(xint)/wactual*1000+(xtrig-xint)/u2*1000;

        document.Timing.wactual.value = wactual;

        document.Timing.mactual.value = mactual;

        document.Timing.tdelayshock.value = tdelayshock;

        document.Timing.tdelaymembrane.value = tdelaymembrane;

}



function calcBoost() {

        var drivervol,boostvol,prupture,percless,percmore,ru;

        var r,mw4,g4,psig,ppa,ppreboost,ppostboost,pboosttank;

        var deltap,deltam,t;

        psig=parseFloat(14.696);

        ppa=parseFloat(101325);

        drivervol = parseFloat(document.Boosttank.drivervol.value);

        boostvol = parseFloat(document.Boosttank.boostvol.value);

        prupture = parseFloat(document.Boosttank.prupture.value)*ppa/psig;

        percless = parseFloat(document.Boosttank.percless.value);

        percmore = parseFloat(document.Boosttank.percmore.value);

     

        // decide driver gas

        if (document.Shock.drivergas.value == "1"){

              g4=parseFloat(1.4020);

              mw4=parseFloat(28.9660);

            }

        if (document.Shock.drivergas.value == "2"){

             g4=parseFloat(1.6700);

            mw4=parseFloat(39.948000);

            }

        if (document.Shock.drivergas.value == "3"){

             g4=parseFloat(1.29700);

            mw4=parseFloat(44.01000);

            }

        if (document.Shock.drivergas.value == "4"){

             g4=parseFloat(1.66700);

            mw4=parseFloat(4.002602000);

            }

        if (document.Shock.drivergas.value == "5"){

             g4=parseFloat(1.66700);

            mw4=parseFloat(20.179700);

            }

        if (document.Shock.drivergas.value == "6"){

             g4=parseFloat(1.40100);

            mw4=parseFloat(28.0134000);

            }

        if (document.Shock.drivergas.value == "7"){

             g4=parseFloat(1.66700);

            mw4=parseFloat(131.29000);

            }

        if (document.Shock.drivergas.value == "8"){

             g4=parseFloat(1.09200);

            mw4=parseFloat(146.06000);

            }

        ru=parseFloat(8314.510);

        // document.write("ru " + ru + "  ");

        r=ru/mw4;

        ppreboost=prupture*(1-percless/100);

        ppostboost=prupture*(1+percmore/100);

        deltap=ppostboost-ppreboost;

        t=parseFloat(document.Shock.tid.value);
        
        deltam=deltap*drivervol/r/t;


        pboosttank=deltam/boostvol*r*t+prupture;

       // document.write("pboosttank " + pboosttank + "  ");

       document.Boosttank.ppreboost.value = ppreboost*psig/ppa

       document.Boosttank.ppostboost.value = ppostboost*psig/ppa

       document.Boosttank.pboosttank.value = pboosttank*psig/ppa

       

       

}

// Gas database with properties
var gasDatabase = {
    "1": {name: "Air", gamma: 1.4020, mw: 28.9660},
    "2": {name: "Argon", gamma: 1.6700, mw: 39.948000},
    "3": {name: "Carbon Dioxide", gamma: 1.29700, mw: 44.01000},
    "4": {name: "Helium", gamma: 1.66700, mw: 4.002602000},
    "5": {name: "Neon", gamma: 1.66700, mw: 20.179700},
    "6": {name: "Nitrogen", gamma: 1.40100, mw: 28.0134000},
    "7": {name: "Xenon", gamma: 1.66700, mw: 131.29000},
    "8": {name: "Sulfur Hexafluoride", gamma: 1.09200, mw: 146.06000},
    "10": {name: "Acetone Vapor", gamma: 1.14000, mw: 58.08000}
};

// Store mixture compositions
var mixtures = {
    driven: [],
    driver: []
};

// Custom gases stored in localStorage
var customGases = {};
var customGasCounter = 0;

// Load custom gases from localStorage on page load
function loadCustomGases() {
    try {
        var stored = localStorage.getItem('wistl_custom_gases');
        if (stored) {
            var gases = JSON.parse(stored);
            customGases = {};
            for (var i = 0; i < gases.length; i++) {
                var gas = gases[i];
                customGases[gas.id] = gas;
                // Update counter to avoid ID collisions
                var numPart = parseInt(gas.id.replace('custom_', ''));
                if (numPart >= customGasCounter) {
                    customGasCounter = numPart + 1;
                }
            }
        }
    } catch (e) {
        console.error('Error loading custom gases:', e);
    }
}

// Save custom gases to localStorage
function saveCustomGases() {
    try {
        var gasArray = [];
        for (var id in customGases) {
            gasArray.push(customGases[id]);
        }
        localStorage.setItem('wistl_custom_gases', JSON.stringify(gasArray));
    } catch (e) {
        alert('Error saving custom gases. Storage quota may be exceeded.');
        console.error('Error saving custom gases:', e);
    }
}

// Get all gases (predefined + custom)
function getAllGases() {
    var allGases = {};
    // Add predefined gases
    for (var id in gasDatabase) {
        allGases[id] = gasDatabase[id];
    }
    // Add custom gases
    for (var id in customGases) {
        allGases[id] = customGases[id];
    }
    return allGases;
}

// Clear all output fields
function clearOutputFields() {
    // Shock calculator outputs
    document.Shock.pdriv.value = '';
    document.Shock.tdriv.value = '';
    document.Shock.ddriv.value = '';
    document.Shock.adriv.value = '';
    document.Shock.pshocked.value = '';
    document.Shock.tshocked.value = '';
    document.Shock.dshocked.value = '';
    document.Shock.ashocked.value = '';
    document.Shock.ushocked.value = '';
    document.Shock.pfour.value = '';
    document.Shock.pfourpsig.value = '';
    document.Shock.tfour.value = '';
    document.Shock.dfour.value = '';
    document.Shock.afour.value = '';
    document.Shock.preflect.value = '';
    document.Shock.treflect.value = '';
    document.Shock.dreflect.value = '';
    document.Shock.areflect.value = '';
    document.Shock.wreflect.value = '';
    document.Shock.mreflect.value = '';
    document.Shock.wshocked.value = '';
    document.Shock.outmw.value = '';
    document.Shock.outgamma.value = '';
    
    // Timing calculator outputs
    document.Timing.wactual.value = '';
    document.Timing.mactual.value = '';
    document.Timing.tdelayshock.value = '';
    document.Timing.tdelaymembrane.value = '';
    
    // Boost tank calculator outputs
    document.Boosttank.ppreboost.value = '';
    document.Boosttank.ppostboost.value = '';
    document.Boosttank.pboosttank.value = '';
}

// Initialize custom gases on page load
window.onload = function() {
    loadCustomGases();
    updateCustomGasList();
    loadCalculatorState();
    clearOutputFields();
};

// Save calculator state to localStorage
function saveCalculatorState() {
    try {
        var state = {
            mach: document.Shock.mach.value,
            pinit: document.Shock.pinit.value,
            tinit: document.Shock.tinit.value,
            tid: document.Shock.tid.value,
            areafact: document.Shock.areafact.value,
            drivengas: document.Shock.drivengas.value,
            drivergas: document.Shock.drivergas.value
        };
        
        // If custom mixture is selected, save the mixture compositions
        if (state.drivengas === 'custom') {
            state.drivenMixture = [];
            for (var i = 0; i < mixtures.driven.length; i++) {
                var index = mixtures.driven[i];
                var gasSelect = document.getElementById('driven_gas_' + index);
                var fracInput = document.getElementById('driven_frac_' + index);
                if (gasSelect && fracInput && gasSelect.value) {
                    state.drivenMixture.push({
                        gasId: gasSelect.value,
                        fraction: fracInput.value
                    });
                }
            }
        }
        
        if (state.drivergas === 'custom') {
            state.driverMixture = [];
            for (var i = 0; i < mixtures.driver.length; i++) {
                var index = mixtures.driver[i];
                var gasSelect = document.getElementById('driver_gas_' + index);
                var fracInput = document.getElementById('driver_frac_' + index);
                if (gasSelect && fracInput && gasSelect.value) {
                    state.driverMixture.push({
                        gasId: gasSelect.value,
                        fraction: fracInput.value
                    });
                }
            }
        }
        
        localStorage.setItem('wistl_calculator_state', JSON.stringify(state));
    } catch (e) {
        console.error('Error saving calculator state:', e);
    }
}

// Load calculator state from localStorage
function loadCalculatorState() {
    try {
        var stored = localStorage.getItem('wistl_calculator_state');
        if (!stored) return;
        
        var state = JSON.parse(stored);
        
        // Restore basic inputs
        if (state.mach) document.Shock.mach.value = state.mach;
        if (state.pinit) document.Shock.pinit.value = state.pinit;
        if (state.tinit) document.Shock.tinit.value = state.tinit;
        if (state.tid) document.Shock.tid.value = state.tid;
        if (state.areafact) document.Shock.areafact.value = state.areafact;
        
        // Restore gas selections
        if (state.drivengas) {
            document.Shock.drivengas.value = state.drivengas;
            toggleMixtureInputs('driven');
            
            // Restore custom mixture if it was selected
            if (state.drivengas === 'custom' && state.drivenMixture && state.drivenMixture.length > 0) {
                // Clear any existing mixture components
                mixtures.driven = [];
                document.getElementById('driven_mixture_inputs').innerHTML = '';
                
                // Recreate mixture components
                for (var i = 0; i < state.drivenMixture.length; i++) {
                    addGasToMixture('driven');
                    var index = mixtures.driven[mixtures.driven.length - 1];
                    var gasSelect = document.getElementById('driven_gas_' + index);
                    var fracInput = document.getElementById('driven_frac_' + index);
                    
                    if (gasSelect && fracInput) {
                        gasSelect.value = state.drivenMixture[i].gasId;
                        fracInput.value = state.drivenMixture[i].fraction;
                    }
                }
                updateMixtureTotal('driven');
            }
        }
        
        if (state.drivergas) {
            document.Shock.drivergas.value = state.drivergas;
            toggleMixtureInputs('driver');
            
            // Restore custom mixture if it was selected
            if (state.drivergas === 'custom' && state.driverMixture && state.driverMixture.length > 0) {
                // Clear any existing mixture components
                mixtures.driver = [];
                document.getElementById('driver_mixture_inputs').innerHTML = '';
                
                // Recreate mixture components
                for (var i = 0; i < state.driverMixture.length; i++) {
                    addGasToMixture('driver');
                    var index = mixtures.driver[mixtures.driver.length - 1];
                    var gasSelect = document.getElementById('driver_gas_' + index);
                    var fracInput = document.getElementById('driver_frac_' + index);
                    
                    if (gasSelect && fracInput) {
                        gasSelect.value = state.driverMixture[i].gasId;
                        fracInput.value = state.driverMixture[i].fraction;
                    }
                }
                updateMixtureTotal('driver');
            }
        }
    } catch (e) {
        console.error('Error loading calculator state:', e);
    }
}

// Update the custom gases list display
function updateCustomGasList() {
    var listDiv = document.getElementById('custom_gas_list');
    var managementDiv = document.getElementById('custom_gas_management');
    
    if (!listDiv || !managementDiv) return;
    
    var gasCount = 0;
    for (var id in customGases) {
        gasCount++;
    }
    
    if (gasCount === 0) {
        managementDiv.style.display = 'none';
        return;
    }
    
    managementDiv.style.display = 'block';
    
    var html = '<table style="border-collapse:collapse; font-size:small;">';
    html += '<tr style="background-color:#ddd; font-weight:bold;">';
    html += '<td style="padding:3px 8px; border:1px solid #999;">Gas Name</td>';
    html += '<td style="padding:3px 8px; border:1px solid #999;">Gamma (\u03B3)</td>';
    html += '<td style="padding:3px 8px; border:1px solid #999;">MW (g/mol)</td>';
    html += '<td style="padding:3px 8px; border:1px solid #999;">Action</td>';
    html += '</tr>';
    
    for (var id in customGases) {
        var gas = customGases[id];
        html += '<tr>';
        html += '<td style="padding:3px 8px; border:1px solid #ccc;">\u2605 ' + gas.name + '</td>';
        html += '<td style="padding:3px 8px; border:1px solid #ccc;">' + gas.gamma.toFixed(4) + '</td>';
        html += '<td style="padding:3px 8px; border:1px solid #ccc;">' + gas.mw.toFixed(4) + '</td>';
        html += '<td style="padding:3px 8px; border:1px solid #ccc;">';
        html += '<button type="button" onclick="deleteCustomGas(\'' + id + '\')" style="font-size:small;">Delete</button>';
        html += '</td>';
        html += '</tr>';
    }
    
    html += '</table>';
    listDiv.innerHTML = html;
}

// Delete a custom gas
function deleteCustomGas(gasId) {
    var gas = customGases[gasId];
    if (!gas) return;
    
    if (!confirm('Are you sure you want to delete "' + gas.name + '"?\n\nThis will remove it from all mixture dropdowns.')) {
        return;
    }
    
    // Check if this gas is currently being used in any mixture
    var inUse = false;
    var types = ['driven', 'driver'];
    for (var t = 0; t < types.length; t++) {
        var type = types[t];
        for (var i = 0; i < mixtures[type].length; i++) {
            var index = mixtures[type][i];
            var select = document.getElementById(type + '_gas_' + index);
            if (select && select.value === gasId) {
                inUse = true;
                break;
            }
        }
        if (inUse) break;
    }
    
    if (inUse) {
        alert('Warning: This gas is currently selected in a mixture. It will be removed from the selection.');
    }
    
    // Delete the gas
    delete customGases[gasId];
    saveCustomGases();
    
    // Update the list
    updateCustomGasList();
    
    // Remove from all dropdowns and reset selections if this gas was selected
    for (var t = 0; t < types.length; t++) {
        var type = types[t];
        for (var i = 0; i < mixtures[type].length; i++) {
            var index = mixtures[type][i];
            var select = document.getElementById(type + '_gas_' + index);
            if (select) {
                // If this gas was selected, reset the selection
                if (select.value === gasId) {
                    select.value = '';
                }
                
                // Remove the option from the dropdown
                var options = select.options;
                for (var j = options.length - 1; j >= 0; j--) {
                    if (options[j].value === gasId) {
                        select.remove(j);
                        break;
                    }
                }
            }
        }
    }
    
    // Update mixture totals in case we removed a selected gas
    updateMixtureTotal('driven');
    updateMixtureTotal('driver');
}

// Toggle visibility of mixture input sections
function toggleMixtureInputs(type) {
    var selectElement = document.Shock[type + 'gas'];
    var divElement = document.getElementById(type + '_mixture_div');
    
    if (selectElement.value === 'custom') {
        divElement.style.display = 'block';
        // Initialize with one gas input if empty
        if (mixtures[type].length === 0) {
            addGasToMixture(type);
        }
    } else {
        divElement.style.display = 'none';
    }
}

// Add a new gas component to the mixture
function addGasToMixture(type) {
    var container = document.getElementById(type + '_mixture_inputs');
    var index = mixtures[type].length;
    
    var div = document.createElement('div');
    div.id = type + '_mix_' + index;
    div.style.marginBottom = '5px';
    
    var select = document.createElement('select');
    select.id = type + '_gas_' + index;
    select.onchange = function() { 
        handleGasSelection(type, index);
    };
    
    // Add gas options
    var emptyOption = document.createElement('option');
    emptyOption.value = '';
    emptyOption.text = 'Select Gas';
    select.appendChild(emptyOption);
    
    // Add "Define New Gas..." option
    var defineOption = document.createElement('option');
    defineOption.value = 'define_new';
    defineOption.text = '--- Define New Gas... ---';
    select.appendChild(defineOption);
    
    // Collect all gases and sort alphabetically
    var allGasOptions = [];
    
    // Add predefined gases
    for (var gasId in gasDatabase) {
        allGasOptions.push({
            value: gasId,
            text: gasDatabase[gasId].name,
            sortKey: gasDatabase[gasId].name
        });
    }
    
    // Add custom gases (with special marker)
    for (var gasId in customGases) {
        allGasOptions.push({
            value: gasId,
            text: '\u2605 ' + customGases[gasId].name,
            sortKey: customGases[gasId].name
        });
    }
    
    // Sort alphabetically by name
    allGasOptions.sort(function(a, b) {
        return a.sortKey.localeCompare(b.sortKey);
    });
    
    // Add sorted options to select
    for (var i = 0; i < allGasOptions.length; i++) {
        var option = document.createElement('option');
        option.value = allGasOptions[i].value;
        option.text = allGasOptions[i].text;
        select.appendChild(option);
    }
    
    var input = document.createElement('input');
    input.type = 'text';
    input.id = type + '_frac_' + index;
    input.size = 6;
    input.maxLength = 8;
    input.placeholder = '0.0';
    input.onkeyup = function() { updateMixtureTotal(type); };
    input.onchange = function() { updateMixtureTotal(type); };
    
    var removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.innerHTML = 'Remove';
    removeBtn.onclick = function() { removeGasFromMixture(type, index); };
    
    div.appendChild(select);
    div.appendChild(document.createTextNode(' Mole Fraction: '));
    div.appendChild(input);
    div.appendChild(document.createTextNode(' '));
    div.appendChild(removeBtn);
    
    // Container for custom gas definition form (initially hidden)
    var defineDiv = document.createElement('div');
    defineDiv.id = type + '_define_' + index;
    defineDiv.style.display = 'none';
    defineDiv.style.marginLeft = '20px';
    defineDiv.style.marginTop = '5px';
    defineDiv.style.padding = '8px';
    defineDiv.style.backgroundColor = '#ffe';
    defineDiv.style.border = '1px solid #cc9';
    div.appendChild(document.createElement('br'));
    div.appendChild(defineDiv);
    
    container.appendChild(div);
    mixtures[type].push(index);
    
    updateMixtureTotal(type);
}

// Handle gas selection (including "Define New Gas" option)
function handleGasSelection(type, index) {
    var select = document.getElementById(type + '_gas_' + index);
    var defineDiv = document.getElementById(type + '_define_' + index);
    
    if (select.value === 'define_new') {
        // Show the custom gas definition form
        showDefineGasForm(type, index);
    } else {
        // Hide the definition form if it was showing
        if (defineDiv) {
            defineDiv.style.display = 'none';
        }
        updateMixtureTotal(type);
    }
}

// Show the custom gas definition form
function showDefineGasForm(type, index) {
    var defineDiv = document.getElementById(type + '_define_' + index);
    
    defineDiv.innerHTML = '<b>Define New Gas:</b><br>' +
        'Name: <input type="text" id="' + type + '_newgas_name_' + index + '" size="15" placeholder="e.g., Methane"> ' +
        'Gamma (\u03B3): <input type="text" id="' + type + '_newgas_gamma_' + index + '" size="8" placeholder="e.g., 1.31"> ' +
        'MW (g/mol): <input type="text" id="' + type + '_newgas_mw_' + index + '" size="8" placeholder="e.g., 16.04"> ' +
        '<button type="button" onclick="saveCustomGas(\'' + type + '\', ' + index + ')">Save Gas</button> ' +
        '<button type="button" onclick="cancelDefineGas(\'' + type + '\', ' + index + ')">Cancel</button>';
    
    defineDiv.style.display = 'block';
}

// Save a new custom gas
function saveCustomGas(type, index) {
    var nameInput = document.getElementById(type + '_newgas_name_' + index);
    var gammaInput = document.getElementById(type + '_newgas_gamma_' + index);
    var mwInput = document.getElementById(type + '_newgas_mw_' + index);
    
    var name = nameInput.value.trim();
    var gamma = parseFloat(gammaInput.value);
    var mw = parseFloat(mwInput.value);
    
    // Validate inputs
    if (!name) {
        alert('Please enter a gas name.');
        nameInput.focus();
        return;
    }
    
    if (isNaN(gamma) || gamma <= 1.0) {
        alert('Gamma must be a number greater than 1.0 (thermodynamically required for ideal gases).');
        gammaInput.focus();
        return;
    }
    
    if (isNaN(mw) || mw <= 0) {
        alert('Molecular weight must be a positive number.');
        mwInput.focus();
        return;
    }
    
    // Check for duplicate name
    var allGases = getAllGases();
    for (var id in allGases) {
        if (allGases[id].name.toLowerCase() === name.toLowerCase()) {
            alert('A gas with this name already exists. Please use a different name.');
            nameInput.focus();
            return;
        }
    }
    
    // Create new custom gas
    var gasId = 'custom_' + customGasCounter++;
    customGases[gasId] = {
        id: gasId,
        name: name,
        gamma: gamma,
        mw: mw
    };
    
    // Save to localStorage
    saveCustomGases();
    
    // Update the gas selection dropdown
    var select = document.getElementById(type + '_gas_' + index);
    var option = document.createElement('option');
    option.value = gasId;
    option.text = '\u2605 ' + name;
    option.selected = true;
    select.appendChild(option);
    
    // Hide the definition form
    var defineDiv = document.getElementById(type + '_define_' + index);
    defineDiv.style.display = 'none';
    
    // Update custom gases list
    updateCustomGasList();
    
    // Refresh all other dropdowns to include the new gas
    refreshAllGasDropdowns();
    
    alert('Custom gas "' + name + '" saved successfully!');
    updateMixtureTotal(type);
}

// Cancel custom gas definition
function cancelDefineGas(type, index) {
    var select = document.getElementById(type + '_gas_' + index);
    var defineDiv = document.getElementById(type + '_define_' + index);
    
    select.value = '';
    defineDiv.style.display = 'none';
    updateMixtureTotal(type);
}

// Refresh all gas dropdowns to include newly added custom gases
function refreshAllGasDropdowns() {
    var types = ['driven', 'driver'];
    
    for (var t = 0; t < types.length; t++) {
        var type = types[t];
        for (var i = 0; i < mixtures[type].length; i++) {
            var index = mixtures[type][i];
            var select = document.getElementById(type + '_gas_' + index);
            if (select) {
                var currentValue = select.value;
                
                // Remove old custom gas options
                var options = select.options;
                for (var j = options.length - 1; j >= 0; j--) {
                    if (options[j].value.indexOf('custom_') === 0) {
                        select.remove(j);
                    }
                }
                
                // Add updated custom gas options
                for (var gasId in customGases) {
                    var option = document.createElement('option');
                    option.value = gasId;
                    option.text = '\u2605 ' + customGases[gasId].name;
                    select.appendChild(option);
                }
                
                // Restore previous selection if it still exists
                select.value = currentValue;
            }
        }
    }
}

// Remove a gas component from the mixture
function removeGasFromMixture(type, index) {
    var div = document.getElementById(type + '_mix_' + index);
    if (div) {
        div.remove();
        var idx = mixtures[type].indexOf(index);
        if (idx > -1) {
            mixtures[type].splice(idx, 1);
        }
        updateMixtureTotal(type);
    }
}

// Update and display the total mole fraction
function updateMixtureTotal(type) {
    var total = 0.0;
    var valid = true;
    
    for (var i = 0; i < mixtures[type].length; i++) {
        var index = mixtures[type][i];
        var input = document.getElementById(type + '_frac_' + index);
        if (input) {
            var val = parseFloat(input.value);
            if (!isNaN(val)) {
                total += val;
            }
        }
    }
    
    var totalSpan = document.getElementById(type + '_total');
    var displayTotal = Math.round(total * 100 * 100) / 100; // Round to 2 decimal places
    
    if (Math.abs(total - 1.0) < 0.001) {
        totalSpan.innerHTML = '<span style="color:green;">Total: ' + displayTotal + '% &#10003;</span>';
    } else if (total > 0) {
        totalSpan.innerHTML = '<span style="color:red;">Total: ' + displayTotal + '% (must equal 100%)</span>';
    } else {
        totalSpan.innerHTML = '<span style="color:#666;">Total: 0%</span>';
    }
}

// Calculate mixture properties (gamma and molecular weight)
function calculateMixtureProperties(type) {
    var totalFraction = 0.0;
    var components = [];
    
    // Collect all components
    for (var i = 0; i < mixtures[type].length; i++) {
        var index = mixtures[type][i];
        var gasSelect = document.getElementById(type + '_gas_' + index);
        var fracInput = document.getElementById(type + '_frac_' + index);
        
        if (gasSelect && fracInput) {
            var gasId = gasSelect.value;
            var fraction = parseFloat(fracInput.value);
            
            if (gasId && !isNaN(fraction) && fraction > 0) {
                components.push({
                    gasId: gasId,
                    fraction: fraction
                });
                totalFraction += fraction;
            }
        }
    }
    
    // Validate total fraction
    if (Math.abs(totalFraction - 1.0) > 0.001) {
        alert('Error: Mole fractions must sum to 1.0 (100%). Current total: ' + (totalFraction * 100).toFixed(2) + '%');
        return null;
    }
    
    if (components.length === 0) {
        alert('Error: No gas components specified in custom mixture.');
        return null;
    }
    
    // Get all available gases (predefined + custom)
    var allGases = getAllGases();
    
    // Calculate mixture molecular weight (simple weighted average)
    var mw_mix = 0.0;
    for (var i = 0; i < components.length; i++) {
        var gas = allGases[components[i].gasId];
        if (!gas) continue;
        mw_mix += components[i].fraction * gas.mw;
    }
    
    // Calculate mixture gamma using specific heats
    // For each gas: Cv = R/(gamma - 1), Cp = gamma * Cv
    // Then: Cv_mix = sum(x_i * Cv_i), Cp_mix = sum(x_i * Cp_i)
    // Finally: gamma_mix = Cp_mix / Cv_mix
    
    var cv_mix = 0.0;
    var cp_mix = 0.0;
    
    for (var i = 0; i < components.length; i++) {
        var gas = allGases[components[i].gasId];
        if (!gas) continue;
        var x = components[i].fraction;
        var gamma = gas.gamma;
        
        // Specific heats (normalized by R/MW, which cancels out in the ratio)
        var cv = 1.0 / (gamma - 1.0);
        var cp = gamma * cv;
        
        cv_mix += x * cv;
        cp_mix += x * cp;
    }
    
    var gamma_mix = cp_mix / cv_mix;
    
    return {
        gamma: gamma_mix,
        mw: mw_mix
    };
}

            </script>

<!-- Custom Gas Management Section -->
<div id="custom_gas_management" style="background-color:#F1EFF7; padding:10px; margin-bottom:15px; border:1px solid #CDD1E2;">
  <b>Custom Gases Library:</b> <span style="font-size:smaller; color:#555962;">(Saved in browser storage)</span><br>
  <div id="custom_gas_list" style="margin-top:5px; margin-left:10px;">
    <span style="color:#555962; font-style:italic;">No custom gases defined yet.</span>
  </div>
</div>

<form name="Shock"><h2>Shock Tube Calculator</h2>

<hr>
<h3>Input</h3>
<select name="drivengas" onchange="toggleMixtureInputs('driven')">
  <option value="">Select a Driven Gas</option>
  <option value="custom">Custom Mixture</option>
  <option value="1" selected="selected">Air</option> 
  <option value="2">Argon</option> 
  <option value="3">Carbon Dioxide</option>
  <option value="4">Helium</option> 
  <option value="5">Neon</option>
  <option value="6">Nitrogen</option> 
  <option value="8">Sulfur Hexafluoride</option>
  <option value="7">Xenon</option>
</select>  Driven Gas <br>
<div id="driven_mixture_div" style="display:none; margin-left:20px; background-color:#F1EFF7; padding:10px; margin-top:5px; margin-bottom:5px; border:1px solid #CDD1E2;">
  <b>Custom Mixture (Mole Fractions):</b><br>
  <div id="driven_mixture_inputs"></div>
  <button type="button" onclick="addGasToMixture('driven')">Add Gas Component</button>
  <span id="driven_total" style="margin-left:10px;"></span>
</div>
<input maxlength="9" name="mach" size="9" value="1.53">  Mach Number (Desired) <br>
<input maxlength="9" name="pinit" size="9" value="101325"> Pa, Initial Pressure, Driven Section <br>
<input maxlength="9" name="tinit" size="9" value="300"> K, Initial Temperature, Driven Section <br>

<select name="drivergas" onchange="toggleMixtureInputs('driver')">
  <option value="">Select a Driver Gas</option>
  <option value="custom">Custom Mixture</option>
  <option value="1" selected="selected">Air</option> 
  <option value="2">Argon</option> 
  <option value="3">Carbon Dioxide</option>
  <option value="4">Helium</option>
  <option value="5">Neon</option>
  <option value="6">Nitrogen</option> 
  <option value="8">Sulfur Hexafluoride</option>
  <option value="7">Xenon</option>
</select> Driver Gas <br>
<div id="driver_mixture_div" style="display:none; margin-left:20px; background-color:#F1EFF7; padding:10px; margin-top:5px; margin-bottom:5px; border:1px solid #CDD1E2;">
  <b>Custom Mixture (Mole Fractions):</b><br>
  <div id="driver_mixture_inputs"></div>
  <button type="button" onclick="addGasToMixture('driver')">Add Gas Component</button>
  <span id="driver_total" style="margin-left:10px;"></span>
</div>

<input maxlength="9" name="tid" size="9" value="300"> K, Initial Temperature, Driver Section <br>
<input name="convert" onclick="calcShock()" type="button" value="Calculate"> <input name="reset" type="reset" value="Reset"> <br>

<hr>

<h3>Output</h3>

<table border="1">

  <tbody>

  <tr>

    <td align="center"> </td>

    <td align="center">Unshocked</td>

    <td align="center">Shocked</td>

    <td align="center">Driver</td>

    <td align="center">Reshocked</td>
    <td align="center"></td></tr>

  <tr>

    <td align="center">Pressure</td>

    <td align="center"><input maxlength="9" name="pdriv" size="9" value="0.101325"></td>

    <td align="center"><input maxlength="9" name="pshocked" size="9" value="0.2599304145587011"></td>

    <td align="center"><input maxlength="9" name="pfour" size="9" value="0.7858588290526163"></td>

    <td align="center"><input maxlength="9" name="preflect" size="9" value="0.5922303848754988"></td>

    <td align="center">MPa</td></tr>

  <tr>

    <td align="center">Temperature</td>

    <td align="center"><input maxlength="9" name="tdriv" size="9" value="300"></td>

    <td align="center"><input maxlength="9" name="tshocked" size="9" value="402.5381757242417"></td>

    <td align="center"><input maxlength="9" name="tfour" size="9" value="300"></td>

    <td align="center"><input maxlength="9" name="treflect" size="9" value="517.9845985458894"></td>

    <td align="center">K</td></tr>

  <tr>

    <td align="center">Density</td>

    <td align="center"><input maxlength="9" name="ddriv" size="9" value="1.1766497965604708"></td>

    <td align="center"><input maxlength="9" name="dshocked" size="9" value="2.24958232829663"></td>

    <td align="center"><input maxlength="9" name="dfour" size="9" value="9.125888293412393"></td>

    <td align="center"><input maxlength="9" name="dreflect" size="9" value="3.9831412255673455"></td>

    <td align="center">kg/m<sup>3</sup></td></tr>

  <tr>

    <td align="center">Sound Speed</td>

    <td align="center"><input maxlength="9" name="adriv" size="9" value="347.4631087739363"></td>

    <td align="center"><input maxlength="9" name="ashocked" size="9" value="402.48677117799417"></td>

    <td align="center"><input maxlength="9" name="afour" size="9" value="347.4631087739363"></td>

    <td align="center"><input maxlength="9" name="areflect" size="9" value="456.56908045297877"></td>

    <td align="center">m/s</td></tr>

  <tr>

    <td align="center">Velocity</td>

    <td align="center">0</td>

    <td align="center"><input maxlength="9" name="ushocked" size="9" value="253.55410935058"></td>

    <td align="center">0</td>

    <td align="center">0</td>

    <td align="center">m/s</td></tr></tbody></table><small>Notes: 

<br>MW = <input maxlength="9" name="outmw" size="9" value="28.966"> Specific heat ratio = 

<input maxlength="9" name="outgamma" size="9" value="1.402"><br>Initial wave speed = 

<input maxlength="9" name="wshocked" size="9" value="531.6185564241225"> m/s<br>Reflected wave speed = 

<input maxlength="9" name="wreflect" size="9" value="329.02882305300926"> m/s, M<sub>R</sub> =

<input maxlength="9" name="mreflect" size="9" value="1.447458585280931"><br>Approximate driver pressure 

(<input maxlength="5" name="areafact" size="5" value="1.35"> factor for area contraction) =

<input maxlength="9" name="pfourpsig" size="9" value="73.54339557717464"> psig

<br><a href="#" onclick="showEquationsModal(); return false;">View Equations</a>

</small>

<hr>



<form name="Timing">Timing Issues<br>Input<br>

<input maxlength="9" name="xwave" size="9" value="0.654"> m, Distance Between Pressure Transducers <br>

<input maxlength="9" name="twave" size="9" value=" "> ms, Time Between Pressure Transducers <br>

<input maxlength="9" name="xtrig" size="9" value="0.859"> m, Distance Between Trigger Transducer 

and Window Centerline <br>

<input maxlength="9" name="xint" size="9" value="0.4"> m, Distance Between Trigger Transducer 

and Interface <br>

Output<br>

<input maxlength="9" name="wactual" size="9" value=" "> m/s, Actual Wave Speed <br>

<input maxlength="9" name="mactual" size="9" value=" "> Actual Mach Number <br>

<input maxlength="9" name="tdelayshock" size="9" value=" "> ms, Estimated Delay Time for Shock <br>

<input maxlength="9" name="tdelaymembrane" size="9" value=" "> ms, Estimated Delay Time for Membrane <br>

<input name="convert" onclick="calcTime()" type="button" value="Calculate">

<input name="reset" type="reset" value="Reset"> </form>

<hr>



<form name="Boosttank"> Boost Tank<br>Input<br>

<input maxlength="9" name="drivervol" size="9" value="0.2862"> m<sup>3</sup>, Volume of the Driver <br>

<input maxlength="9" name="boostvol" size="9" value="0.0538"> m<sup>3</sup>, Volume of the Boost Tank <br>

<input maxlength="9" name="prupture" size="9" value=" "> psig, Diaphragm Rupture Pressure <br>

<input maxlength="9" name="percless" size="9" value="5"> %, Less than Rupture Pressure (for Pre-boost) <br>

<input maxlength="9" name="percmore" size="9" value="20"> %, More than Rupture Pressure (for Post-boost) <br>

Output<br>

<input maxlength="9" name="ppreboost" size="9" value=" "> psig, Pre-boost Driver Pressure <br>

<input maxlength="9" name="ppostboost" size="9" value=" "> psig, Post-boost Driver Pressure <br>

<input maxlength="9" name="pboosttank" size="9" value=" "> psig, Required Boost Tank Pressure <br>

<input name="convert" onclick="calcBoost()" type="button" value="Calculate">

<input name="reset" type="reset" value="Reset"> </form>



<hr>

</form>

</div>

<footer style="text-align:center; margin-top:40px; padding:20px; border-top:1px solid #ddd; color:#666; font-size:small;">
Last updated Jan. 16, 2026 by Alex Ames; original calculator by Jason Oakley. Submit issues & feature requests on <a href="https://github.com/stillyslalom/STCalc" target="_blank">GitHub</a>.
</footer>

<!-- Equations Modal -->
<div id="equationsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Gasdynamic Equations for a Shock Wave</h2>
      <span class="close" onclick="closeEquationsModal()">&times;</span>
    </div>
    
    <div class="equation-section">
      <h3>List of Variables</h3>
      <p>
        \(a \equiv \text{speed of sound}\)<br>
        \(M \equiv \text{Mach number}\)<br>
        \(p \equiv \text{pressure}\)<br>
        \(T \equiv \text{temperature}\)<br>
        \(u_2 \equiv \text{particle velocity}\)<br>
        \(W \equiv \text{speed of wave}\)<br>
        \(\gamma \equiv \text{specific heat ratio}\)<br>
        \(\rho \equiv \text{density}\)
      </p>
    </div>

    <div class="equation-section">
      <h3>Basic Relationships</h3>
      <p>$$M \equiv \frac{W}{a}$$</p>
    </div>

    <div class="equation-section">
      <h3>Jump Relations Across Shock (State 2 - Shocked)</h3>
      
      <p><strong>Pressure Ratio:</strong></p>
      <p>$$\frac{p_2}{p_1} = 1 + \frac{2\gamma}{\gamma+1}\left(M^2-1\right)$$</p>
      
      <p><strong>Temperature Ratio:</strong></p>
      <p>$$\frac{T_2}{T_1} = \frac{p_2}{p_1}\left(\frac{\frac{\gamma+1}{\gamma-1}+\frac{p_2}{p_1}}{1+\frac{\gamma+1}{\gamma-1}\left[\frac{p_2}{p_1}\right]}\right)$$</p>
      
      <p><strong>Density Ratio:</strong></p>
      <p>$$\frac{\rho_2}{\rho_1} = \frac{1+\frac{\gamma+1}{\gamma-1}\left(\frac{p_2}{p_1}\right)}{\frac{\gamma+1}{\gamma-1}+\frac{p_2}{p_1}}$$</p>
      
      <p><strong>Particle Velocity:</strong></p>
      <p>$$u_2 = \frac{a_1}{\gamma}\left(\frac{p_2}{p_1}-1\right)\left(\frac{\frac{2\gamma}{\gamma+1}}{\frac{p_2}{p_1}+\frac{\gamma-1}{\gamma+1}}\right)^{1/2}$$</p>
    </div>

    <div class="equation-section">
      <h3>Reflected Wave Properties (State 5)</h3>
      
      <p><strong>Pressure Ratio:</strong></p>
      <p>$$\frac{p_5}{p_2} = \frac{(3\gamma-1)\frac{p_2}{p_1}-(\gamma-1)}{(\gamma-1)\frac{p_2}{p_1}+(\gamma+1)}$$</p>
      
      <p><strong>Temperature Ratio:</strong></p>
      <p>$$\frac{T_5}{T_2} = \frac{p_5}{p_2}\left(\frac{\frac{\gamma+1}{\gamma-1}+\frac{p_5}{p_2}}{1+\frac{\gamma+1}{\gamma-1}\left[\frac{p_5}{p_2}\right]}\right)$$</p>
      
      <p><strong>Density Ratio:</strong></p>
      <p>$$\frac{\rho_5}{\rho_2} = \frac{1+\frac{\gamma+1}{\gamma-1}\left(\frac{p_5}{p_2}\right)}{\frac{\gamma+1}{\gamma-1}+\frac{p_5}{p_2}}$$</p>
      
      <p><strong>Reflected Wave Speed and Mach Number:</strong></p>
      <p>$$W_R = \frac{\rho_2 u_2}{\rho_5-\rho_2}$$</p>
      <p>$$M_R = \frac{W_R+u_2}{a_2}$$</p>
    </div>

    <div class="equation-section">
      <h3>Driver Section Properties (State 4)</h3>
      <p>$$\frac{p_4}{p_1} = \frac{p_2}{p_1}\left(1-\frac{(\gamma_4-1)(a_1/a_4)(p_2/p_1-1)}{\sqrt{2\gamma_1\left[2\gamma_1+(\gamma_1+1)(p_2/p_1-1)\right]}}\right)^{-2\gamma_4/(\gamma_4-1)}$$</p>
    </div>

    <div class="equation-note">
      <strong>Reference:</strong> Equations taken from <em>Modern Compressible Flow with Historical Perspective</em>, Anderson, 2nd ed.
    </div>
  </div>
</div>

<script>
function showEquationsModal() {
    document.getElementById('equationsModal').style.display = 'block';
    // Trigger MathJax to render the equations
    if (window.MathJax) {
        MathJax.typesetPromise();
    }
}

function closeEquationsModal() {
    document.getElementById('equationsModal').style.display = 'none';
}

// Close modal when clicking outside of it
window.onclick = function(event) {
    var modal = document.getElementById('equationsModal');
    if (event.target == modal) {
        closeEquationsModal();
    }
}
</script>

</body></html>
